{% extends "base.html" %}
{% load static %}

{% block link %}
  <link rel="stylesheet" href={% static 'css/forum.css' %}>
{% endblock %}

{% block script %}
  <script src="{% static 'js/main.js' %}"></script>
{% endblock %}

{% block title %}NeAlmalı - Forum{% endblock %}
  
{% block message %}
  {% include 'message_box.html' %}
{% endblock message %}

{%block search-bar%}
<!-- Arama çubuğu -->
<div class="search-bar">
  <div class="input-group">
  <input type="text" class="form-control" placeholder="" aria-label="Search">
  <button class="input-group-text">
      <i class="bi bi-search"></i>
  </button>

  </div>
</div>
{%endblock search-bar%}

{% block content %}
  <div id="banner" class="banner-container"><!--banner resmi-->
    <img src="pictures/comp.jpg" alt="...">
  </div>
  <div class="category-bar" id="category-bar">
  <!-- Kategoriler buraya gelecek -->
  </div>
  <div class="forum-container ">
    <div class="row">
      
      <!-- Sol taraf: Ana başlık listesi (geniş) -->
      <div class="col-md-8 border-end-md forum-ana-kisim">
        <h2 class="mb-4">İlginizi çekebilecek başlıklar</h2>
        <div class="list-group">

          {% for thread in threads %}
        <div class="list-group-item thread-box" data-url="{% url 'thread_detail' thread.id %}" style="cursor: pointer;">
    
    <!-- Başlık ve Tarih -->
          <div class="d-flex w-100 justify-content-between flex-wrap">
            <h5 class="mb-1 text-dark">{{ thread.title }}</h5>
            <small class="text-muted">{{ thread.created_at|timesince }} önce</small>
          </div>

    <!-- Açıklama -->
          {% if thread.content %}
            <p class="mb-2">
          {{ thread.content }}
            </p>
          {% else %}
            <p class="mb-2 text-muted fst-italic">Açıklama yok.</p>
          {% endif %}

    <!-- Kullanıcı + Beğeni/Görüntülenme + Kategoriler -->
          <div class="d-flex flex-column flex-md-row justify-content-between align-items-start gap-2">

      <!-- Kullanıcı -->
          <small class="text-body-secondary">by {{ thread.user.username }}</small>

          <div class="d-flex flex-column align-items-md-end gap-2">

        <!-- Sayılar -->
          <div class="d-flex align-items-center gap-3 text-muted flex-wrap">
            <span><i class="bi bi-hand-thumbs-up"></i> {{ thread.like_count }}</span>
            <span><i class="bi bi-hand-thumbs-down"></i> {{ thread.dislike_count }}</span>
            <span><i class="bi bi-eye"></i> {{ thread.view_count }}</span>
          </div>

        <!-- Kategoriler -->
          <div class="d-flex flex-wrap gap-1">
            {% for category in thread.categories.all %}
              <a href="{% url 'category_threads' category.id %}" class="badge rounded-pill text-bg-primary text-decoration-none" onclick="event.stopPropagation();">
                {{ category.name }}
              </a>
            {% endfor %}
          </div>

        </div>
      </div>
    </div>
    {% endfor %}

          <div id="dahaFazlaBaslik" style="display: none;">
            <a href="#" class="list-group-item list-group-item-action"> <!--bu tasarım butonların yerini gösteriyo-->
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">Pythonda Veri Tabanı Bağlantısı</h5>
            
                <!-- Kategori ve Tarih sağ üstte -->
                <div class="d-flex align-items-center gap-2">
                  
                  <small class="text-muted">1 hafta önce</small>
                </div>
              </div>
            
              <p class="mb-1">Python ile MySQL bağlantısı nasıl kurulur? En iyi yöntemler nelerdir?</p>
            
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-body-secondary">by DeveloperX</small>
            
                <!-- Beğeni ve Görüntülenme sağ altta -->
                <div class="d-flex align-items-center gap-3 text-muted">
                  <span><i class="bi bi-hand-thumbs-up"></i> 12</span>
                  <span><i class="bi bi-hand-thumbs-down"></i> 3</span>
                  <span><i class="bi bi-eye"></i> 156</span>
                  <span class="badge rounded-pill bg-primary">Python</span>
                </div>
              </div>
            </a>
            <a href="#" class="list-group-item list-group-item-action"> <!--bu tasarım butonların yerini gösteriyo-->
              <div class="d-flex w-100 justify-content-between">
                <h5 class="mb-1">Pythonda Veri Tabanı Bağlantısı</h5>
            
                <!-- Kategori ve Tarih sağ üstte -->
                <div class="d-flex align-items-center gap-2">
                  
                  <small class="text-muted">1 hafta önce</small>
                </div>
              </div>
            
              <p class="mb-1">Python ile MySQL bağlantısı nasıl kurulur? En iyi yöntemler nelerdir?</p>
            
              <div class="d-flex justify-content-between align-items-center">
                <small class="text-body-secondary">by DeveloperX</small>
            
                <!-- Beğeni ve Görüntülenme sağ altta -->
                <div class="d-flex align-items-center gap-3 text-muted">
                  <span><i class="bi bi-hand-thumbs-up"></i> 12</span>
                  <span><i class="bi bi-hand-thumbs-down"></i> 3</span>
                  <span><i class="bi bi-eye"></i> 156</span>
                  <span class="badge rounded-pill bg-primary">Python</span>
                </div>
              </div>
            </a>
      
          </div>
  
        </div>
        <div class="d-grid mt-3">
          <button id="dahaFazlaBaslik" class="btn btn-outline-primary">Daha Fazla Göster</button>
        </div>
      </div>
  
      <!-- Sağ taraf: Son Açılanlar ve Çok Görüntülenenler (dar) -->
      <div class="col-md-4">
  
        <div class="sidebar-section">
          <h4>Son Açılan Başlıklar</h4>
          <div class="list-group">
            <a href="#" class="list-group-item list-group-item-action">Django Forms Kullanımı</a>
            <a href="#" class="list-group-item list-group-item-action">API ile Veri Çekmek</a>
            <a href="#" class="list-group-item list-group-item-action">CSS Grid vs Flexbox</a>
          </div>
        </div>
  
        <div class="sidebar-section">
          <h4>Çok Görüntülenenler</h4>
          <div class="list-group">
            <a href="#" class="list-group-item list-group-item-action">Python İleri Seviye</a>
            <a href="#" class="list-group-item list-group-item-action">Django ile E-Ticaret Sitesi</a>
            <a href="#" class="list-group-item list-group-item-action">HTML5 Yeni Özellikler</a>
          </div>
        </div>
      </div>
    </div>
  </div>

    <!-- forum sayfasında, başlık açma -->
  <div class="container my-5">
    <div class="row justify-content-center">
      <div class="col-md-8">
        <h3 class="mb-3">Yeni Başlık Oluştur</h3>
        <div class="card mb-4 create-topic-form">
          <div class="card-header"></div>
          <div class="card-body">
            {% if user.is_authenticated %}
              <form method="POST" action="{% url 'forum_page' %}">
                {% csrf_token %}
              
               <!-- Başlık -->
                <div class="mb-3">
                  <label for="title" class="form-label">Başlık</label>
                  <input type="text" class="form-control" name="title" id="title" placeholder="Başlık" required>
                </div>

              <!-- İçerik -->
                <div class="mb-3">
                  <label for="content" class="form-label">İçerik</label>
                  <textarea class="form-control" name="content" id="content" placeholder="İçerik" rows="5" required></textarea>
                </div>

              <!-- Kategoriler -->
                <div class="mb-3">
                  <label class="form-label">Kategoriler (çoklu seçim):</label>
                  <div class="form-check">
                    {% for category in categories %}
                      <input class="form-check-input" type="checkbox" name="categories" value="{{ category.id }}" id="category_{{ category.id }}">
                      <label class="form-check-label" for="category_{{ category.id }}">
                        {{ category.name }}
                      </label>
                      <br>
                    {% endfor %}
                  </div>
                </div>

              <!-- Gönder Butonu -->
                <button type="submit" class="btn custom-btn">Yeni Başlık Oluştur</button>
              </form>
            {% else %}
              <div class="alert alert-warning text-center">
                Lütfen <a href="{% url 'login_view' %}">giriş yapın</a>. Yeni başlık oluşturmak için hesabınızla giriş yapmanız gerekmektedir.
              </div>
            {% endif %}
          </div>
        </div>
      </div>
    </div>
  </div>


  <div class="category-grid"><!--burası alt kategoriler kutu haklinde fazla koymuştum onları sileriz-->
    <div class="category-card">
      <img src="moda.png" alt="Moda" class="category-image">
      <div class="category-title">Moda</div>
      <div class="category-info">342 başlık açıldı</div>
    </div>
    <div class="category-card">
      <img src="pictures/moda.png" alt="alışveriş" class="category-image">
      <div class="category-title">Alışveriş&İlanlar</div>
      <div class="category-info">342 başlık açıldı</div>
    </div>
    <div class="category-card">
      <img src="pictures/moda.png" alt="alışveriş" class="category-image">
      <div class="category-title">Alışveriş&İlanlar</div>
      <div class="category-info">342 başlık açıldı</div>
    </div>
    <div class="category-card">
      <img src={% static 'pictures/imageplaceholder.png' %} alt="alışveriş" class="category-image">
      <div class="category-title">Alışveriş&İlanlar</div>
      <div class="category-info">342 başlık açıldı</div>
    </div>
    <div class="category-card">
      <img src="moda.jpg" alt="Moda" class="category-image">
      <div class="category-title">Hobi&yaşam</div>
      <div class="category-info">342 başlık açıldı</div>
    </div>
    <div class="category-card">
      <img src="moda.jpg" alt="Moda" class="category-image">
      <div class="category-title">Destek&yardım</div>
      <div class="category-info">342 başlık açıldı</div>
    </div>
  
    <!-- Daha fazla kategori ekleyebilirsin -->
  </div>
  <script>
    document.querySelectorAll('.thread-box').forEach(function(box) {
      box.addEventListener('click', function() {
        window.location.href = this.dataset.url;
      });
    });
  </script>
  {% endblock %}